<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Tea Timer</title>
</head>
<body>
<span id="timeDisplay">15:00</span>
<button id="startButton">Start</button>
<script>
var lastTime;
var timeLeft;
var timerInterval = null;
var alerted;

var beep1 = new Audio('audio/beep.wav');
var beep2 = new Audio('audio/done.wav');

var firstInfusion = 15; // @TODO
var nextInfusion = 3; // @TODO

function StopTimer() {
	window.clearInterval(timerInterval);
	timerInterval = null;
	startButton.innerText = "Start over";
}

function TimerTick() {
	var now = new Date();
	var elapsed = now - lastTime;
	lastTime = now;
	timeLeft -= elapsed;
	timeDisplay.innerText = timeLeft / 1000;
	if (alerted == false && timeLeft <= 5000) {
		beep1.play();
		alerted = true;
	} else if (timeLeft <= 0) {
		beep2.play();
		StopTimer();
	}
}

startButton.onclick = function() {
	if (timerInterval == null) {
		beep1.play();
		beep1.pause();
		beep2.play();
		beep2.pause();
		alerted = false;
		timeLeft = 10000; // @TODO
		lastTime = new Date();
		timerInterval = window.setInterval(TimerTick, 10);
		startButton.innerText = "Stop";
	} else {
		StopTimer();
	}
}
</script>
</body>
</html>